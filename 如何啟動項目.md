# 如何啟動項目 - HK Urban Ecological Identification

本指南將幫助您啟動和運行香港城市生態識別系統。

## 📋 前置要求

在開始之前，請確保已安裝以下軟件：

1. **Python 3.8 或更高版本**
   - 下載地址：https://www.python.org/downloads/
   - 安裝時請勾選 "Add Python to PATH"

2. **Node.js 16 或更高版本**
   - 下載地址：https://nodejs.org/
   - 建議安裝 LTS 版本

3. **Git**（用於克隆項目和版本控制）
   - 下載地址：https://git-scm.com/

4. **Git LFS**（用於下載大文件，如模型文件）
   - 下載地址：https://git-lfs.github.com/
   - 安裝後運行：`git lfs install`

## 🚀 快速啟動步驟

### 步驟 0：從 GitHub 克隆項目（首次使用）

1. **克隆項目**：
   ```bash
   git clone https://github.com/Charlieppy2/butterfly-bird-identifier.git
   cd butterfly-bird-identifier
   ```

2. **安裝 Git LFS 並下載大文件**：
   ```bash
   git lfs install
   git lfs pull
   ```
   ⚠️ **重要**：必須運行 `git lfs pull` 才能下載模型文件！

### 步驟 1：安裝依賴（首次使用時）

**安裝後端依賴：**

**Windows (PowerShell):**
```powershell
cd web_app\backend
pip install -r requirements.txt
```

**Linux/Mac:**
```bash
cd web_app/backend
pip install -r requirements.txt
```

⚠️ **注意**：首次安裝可能需要 2-5 分鐘，特別是 TensorFlow

**安裝前端依賴：**

**Windows (PowerShell):**
```powershell
cd web_app\frontend
npm install
```

**Linux/Mac:**
```bash
cd web_app/frontend
npm install
```

⚠️ **注意**：首次安裝可能需要 2-5 分鐘，會安裝約 1344 個包

### 方法一：使用批處理文件（Windows - 最簡單）

**啟動後端服務：**
1. 雙擊文件：`web_app\backend\start_backend.bat`
   - 或右鍵選擇「以管理員身份運行」
2. 等待看到以下信息表示啟動成功：
   ```
   Model loaded successfully from ...
   Starting Flask server...
   Running on http://0.0.0.0:5001
   ```
3. **保持此窗口打開**

**啟動前端服務：**
1. 打開**新的** PowerShell 或命令提示符窗口
2. 雙擊文件：`web_app\frontend\start_frontend.bat`
3. 等待編譯完成（約 10-30 秒）
4. 瀏覽器會自動打開 http://localhost:3000
5. **保持此窗口打開**

### 方法二：使用命令行（適用於所有系統）

#### 啟動後端（終端 1）

**Windows (PowerShell):**
```powershell
# 從項目根目錄開始
cd web_app\backend
python app.py
```

**Linux/Mac:**
```bash
# 從項目根目錄開始
cd web_app/backend
python app.py
```

#### 啟動前端（終端 2 - 新窗口）

**Windows (PowerShell):**
```powershell
# 從項目根目錄開始
cd web_app\frontend
npm start
```

**Linux/Mac:**
```bash
# 從項目根目錄開始
cd web_app/frontend
npm start
```

## 🌐 訪問應用

啟動成功後，您可以通過以下地址訪問：

- **前端界面**：http://localhost:3000
  - 這是主要的用戶界面
  - 用於上傳圖片和查看識別結果

- **後端 API**：http://localhost:5001
  - 這是 API 服務器
  - 可以查看 API 狀態信息
  - ⚠️ **注意**：後端使用端口 5001（不是 5000），以避免與 macOS AirPlay Receiver 衝突

## ✅ 驗證服務是否運行

### 檢查後端服務

打開瀏覽器訪問：http://localhost:5001

應該看到：
```json
{
  "status": "success",
  "message": "HK Urban Ecological Identification API is running",
  "model_loaded": true
}
```

如果 `model_loaded` 為 `true`，表示模型已成功加載。

### 檢查前端服務

打開瀏覽器訪問：http://localhost:3000

應該看到：
- 生態主題的綠色漸變背景
- 標題：「🦋🐦 HK Urban Ecological Identification」
- 上傳區域和按鈕

## 📱 使用應用

1. **上傳圖片**
   - 點擊「選擇檔案」按鈕
   - 或直接拖拽圖片到上傳區域
   - 選擇一張蝴蝶或鳥類的圖片

2. **識別**
   - 上傳圖片後，系統會自動進行識別
   - 等待幾秒鐘進行分析

3. **查看結果**
   - 系統會顯示識別結果
   - 包括物種名稱、置信度和前3名預測
   - 如果圖片不是蝴蝶或鳥類，或置信度較低，會顯示警告信息和建议

## ⚠️ 常見問題

### Q1: 後端無法啟動

**問題**：提示 "Model not found" 或 "Model not loaded"

**解決方法**：
1. 確認模型文件存在：`models\trained\model.h5`
2. 確認類別文件存在：`models\trained\class_names.json`
3. 如果文件不存在，需要先訓練模型（見下方）

### Q2: 前端無法連接到後端

**問題**：顯示 "無法連上這個網站" 或 "Connection refused"

**解決方法**：
1. 確認後端服務正在運行（檢查端口 5001）
2. 確認兩個服務都在運行
3. 嘗試清除瀏覽器緩存並刷新
4. 檢查前端控制台是否有錯誤信息

### Q3: 前端編譯錯誤

**問題**：npm start 時出現錯誤

**解決方法**：
1. 刪除 `node_modules` 文件夾
2. 刪除 `package-lock.json` 文件
3. 重新運行 `npm install`
4. 再次運行 `npm start`

### Q4: 端口已被占用

**問題**：提示端口 5001（後端）或 3000（前端）已被使用

**解決方法**：
1. 關閉其他使用這些端口的程序
2. 或修改 `app.py` 中的端口號（後端）
3. 或設置環境變量 `PORT=3001`（前端）
4. **注意**：後端默認使用端口 5001，以避免與 macOS AirPlay Receiver 在端口 5000 上的衝突

### Q5: 模型文件找不到

**問題**：提示 "Model not found" 或模型文件不存在

**解決方法**：
1. 確認已運行 `git lfs install` 和 `git lfs pull`
2. 檢查 `models/trained/model.h5` 文件是否存在
3. 如果文件不存在，運行：
   ```bash
   git lfs pull
   ```
4. 如果仍然沒有，可能需要先訓練模型（見下方）

## 🛑 停止服務

要停止服務，只需：

1. **停止後端**：在後端命令行窗口按 `Ctrl + C`
2. **停止前端**：在前端命令行窗口按 `Ctrl + C`

## 📝 首次使用前的準備

如果您還沒有訓練模型，需要先進行模型訓練：

### 1. 準備數據集

將圖片按類別組織：
```
data/raw/
├── class1/
│   ├── image1.jpg
│   └── ...
├── class2/
│   └── ...
```

### 2. 數據預處理

**Windows:**
```powershell
cd models\training
python prepare_data.py
```

**Linux/Mac:**
```bash
cd models/training
python prepare_data.py
```

### 3. 訓練模型

**Windows:**
```powershell
# 仍在 models\training 目錄下
python train_model.py
```

**Linux/Mac:**
```bash
# 仍在 models/training 目錄下
python train_model.py
```

⚠️ **注意**：訓練可能需要數小時，建議使用 GPU 或 Google Colab

## 🔧 開發模式

- **前端熱重載**：修改前端代碼後會自動刷新瀏覽器
- **後端調試模式**：已啟用，修改代碼後需要重啟服務

## 📞 需要幫助？

如果遇到問題：

1. 檢查 `README.md` 了解詳細文檔
2. 查看 `QUICKSTART.md` 快速開始指南
3. 檢查控制台錯誤信息
4. 確認所有依賴都已正確安裝

## 📋 檢查清單

在啟動項目前，請確認：

- [ ] 已從 GitHub 克隆項目
- [ ] Git LFS 已安裝並運行 `git lfs install`
- [ ] 已運行 `git lfs pull` 下載模型文件
- [ ] Python 3.8+ 已安裝
- [ ] Node.js 16+ 已安裝
- [ ] 後端依賴已安裝（`pip install -r requirements.txt`）
- [ ] 前端依賴已安裝（`npm install`）
- [ ] 模型文件存在（`models/trained/model.h5`）
- [ ] 類別文件存在（`models/trained/class_names.json`）
- [ ] 兩個服務都已啟動
- [ ] 瀏覽器可以訪問 http://localhost:3000
- [ ] 後端 API 可以訪問 http://localhost:5001

---

**祝您使用愉快！** 🦋🐦

